{"ast":null,"code":"'use strict';\n\nvar is = require('is-type-of');\n\nvar protobuf = require('protobufjs');\n\nvar long = require('long');\n\nvar tou8 = require('buffer-to-uint8array');\n/**\n * payAsset operation\n * @param {object} args\n * @returns {string}\n */\n\n\nmodule.exports = function (args) {\n  try {\n    var sourceAddress = args.sourceAddress,\n        destAddress = args.destAddress,\n        code = args.code,\n        issuer = args.issuer,\n        assetAmount = args.assetAmount,\n        metadata = args.metadata;\n    var root = protobuf.Root.fromJSON(require('../../crypto/protobuf/bundle.json'));\n    var assetKey = root.lookupType('protocol.AssetKey');\n    var assetKeyMsg = assetKey.create({\n      issuer: issuer,\n      code: code\n    });\n    var asset = root.lookupType('protocol.Asset');\n    var assetMsg = asset.create({\n      key: assetKeyMsg,\n      amount: long.fromValue(assetAmount)\n    });\n    var operationPayAsset = root.lookupType('protocol.OperationPayAsset');\n    var operationPayAssetMsg = operationPayAsset.create({\n      destAddress: destAddress,\n      asset: assetMsg\n    });\n    var operation = root.lookupType('protocol.Operation');\n    var payload = {\n      payAsset: operationPayAssetMsg,\n      type: operation.Type.PAY_ASSET\n    };\n\n    if (sourceAddress) {\n      payload.sourceAddress = sourceAddress;\n    }\n\n    if (metadata) {\n      payload.metadata = tou8(Buffer.from(metadata, 'utf8'));\n    }\n\n    var err = operation.verify(payload);\n\n    if (err) {\n      throw Error(err);\n    }\n\n    return operation.create(payload);\n  } catch (err) {\n    throw err;\n  }\n};","map":null,"metadata":{},"sourceType":"script"}