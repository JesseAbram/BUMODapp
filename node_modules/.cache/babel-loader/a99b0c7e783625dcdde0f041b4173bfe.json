{"ast":null,"code":"'use strict';\n\nvar _regeneratorRuntime = require(\"/Users/jesse/Desktop/blockx/bumodapp/node_modules/@babel/runtime/regenerator\");\n\nvar wrap = require('co-wrap-all');\n\nvar is = require('is-type-of');\n\nvar merge = require('merge-descriptors');\n\nvar humps = require('humps');\n\nvar JSONbig = require('json-bigint');\n\nvar _require = require('bumo-encryption'),\n    keypair = _require.keypair;\n\nvar errors = require('../exception');\n\nmodule.exports = Ctp10Token;\n\nfunction Ctp10Token(options) {\n  if (!(this instanceof Ctp10Token)) {\n    return new Ctp10Token(options);\n  }\n\n  this.options = options;\n}\n\nvar proto = Ctp10Token.prototype;\nmerge(proto, require('../common/util'));\nproto.checkValid =\n/*#__PURE__*/\n_regeneratorRuntime.mark(function _callee(contractAddress) {\n  return _regeneratorRuntime.wrap(function _callee$(_context) {\n    while (1) {\n      switch (_context.prev = _context.next) {\n        case 0:\n          _context.prev = 0;\n          _context.next = 3;\n          return this._isAvailableToken(contractAddress);\n\n        case 3:\n          return _context.abrupt(\"return\", _context.sent);\n\n        case 6:\n          _context.prev = 6;\n          _context.t0 = _context[\"catch\"](0);\n          throw _context.t0;\n\n        case 9:\n        case \"end\":\n          return _context.stop();\n      }\n    }\n  }, _callee, this, [[0, 6]]);\n});\nproto.getInfo =\n/*#__PURE__*/\n_regeneratorRuntime.mark(function _callee2(contractAddress) {\n  var isContractAddress, args, info, contractInfo;\n  return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n    while (1) {\n      switch (_context2.prev = _context2.next) {\n        case 0:\n          _context2.prev = 0;\n\n          if (keypair.checkAddress(contractAddress)) {\n            _context2.next = 3;\n            break;\n          }\n\n          return _context2.abrupt(\"return\", this._responseError(errors.INVALID_CONTRACTADDRESS_ERROR));\n\n        case 3:\n          _context2.next = 5;\n          return this._isContractAddress(contractAddress);\n\n        case 5:\n          isContractAddress = _context2.sent;\n\n          if (isContractAddress) {\n            _context2.next = 8;\n            break;\n          }\n\n          return _context2.abrupt(\"return\", this._responseError(errors.CONTRACTADDRESS_NOT_CONTRACTACCOUNT_ERROR));\n\n        case 8:\n          args = {\n            optType: 2,\n            contractAddress: contractAddress,\n            input: JSON.stringify({\n              method: 'contractInfo'\n            })\n          };\n          args = humps.decamelizeKeys(args, {\n            separator: '_'\n          }); // convert long to int\n\n          args = this._longToInt(args);\n          args = JSONbig.stringify(args);\n          _context2.next = 14;\n          return this._request('post', 'callContract', args);\n\n        case 14:\n          info = _context2.sent;\n          info = JSONbig.parse(info.result.query_rets[0].result.value);\n          contractInfo = info.contractInfo;\n          return _context2.abrupt(\"return\", this._responseData({\n            ctp: contractInfo.ctp,\n            name: contractInfo.name,\n            symbol: contractInfo.symbol,\n            totalSupply: contractInfo.totalSupply,\n            decimals: contractInfo.decimals,\n            contractOwner: contractInfo.contractOwner\n          }));\n\n        case 20:\n          _context2.prev = 20;\n          _context2.t0 = _context2[\"catch\"](0);\n          throw _context2.t0;\n\n        case 23:\n        case \"end\":\n          return _context2.stop();\n      }\n    }\n  }, _callee2, this, [[0, 20]]);\n});\nproto.getName =\n/*#__PURE__*/\n_regeneratorRuntime.mark(function _callee3(contractAddress) {\n  var isContractAddress, data;\n  return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n    while (1) {\n      switch (_context3.prev = _context3.next) {\n        case 0:\n          _context3.prev = 0;\n\n          if (keypair.checkAddress(contractAddress)) {\n            _context3.next = 3;\n            break;\n          }\n\n          return _context3.abrupt(\"return\", this._responseError(errors.INVALID_CONTRACTADDRESS_ERROR));\n\n        case 3:\n          _context3.next = 5;\n          return this._isContractAddress(contractAddress);\n\n        case 5:\n          isContractAddress = _context3.sent;\n\n          if (isContractAddress) {\n            _context3.next = 8;\n            break;\n          }\n\n          return _context3.abrupt(\"return\", this._responseError(errors.CONTRACTADDRESS_NOT_CONTRACTACCOUNT_ERROR));\n\n        case 8:\n          _context3.next = 10;\n          return this.getInfo(contractAddress);\n\n        case 10:\n          data = _context3.sent;\n\n          if (!(data.result === '')) {\n            _context3.next = 13;\n            break;\n          }\n\n          return _context3.abrupt(\"return\", this._responseData(''));\n\n        case 13:\n          return _context3.abrupt(\"return\", this._responseData({\n            name: data.result.name\n          }));\n\n        case 16:\n          _context3.prev = 16;\n          _context3.t0 = _context3[\"catch\"](0);\n          throw _context3.t0;\n\n        case 19:\n        case \"end\":\n          return _context3.stop();\n      }\n    }\n  }, _callee3, this, [[0, 16]]);\n});\nproto.getSymbol =\n/*#__PURE__*/\n_regeneratorRuntime.mark(function _callee4(contractAddress) {\n  var isContractAddress, data;\n  return _regeneratorRuntime.wrap(function _callee4$(_context4) {\n    while (1) {\n      switch (_context4.prev = _context4.next) {\n        case 0:\n          _context4.prev = 0;\n\n          if (keypair.checkAddress(contractAddress)) {\n            _context4.next = 3;\n            break;\n          }\n\n          return _context4.abrupt(\"return\", this._responseError(errors.INVALID_CONTRACTADDRESS_ERROR));\n\n        case 3:\n          _context4.next = 5;\n          return this._isContractAddress(contractAddress);\n\n        case 5:\n          isContractAddress = _context4.sent;\n\n          if (isContractAddress) {\n            _context4.next = 8;\n            break;\n          }\n\n          return _context4.abrupt(\"return\", this._responseError(errors.CONTRACTADDRESS_NOT_CONTRACTACCOUNT_ERROR));\n\n        case 8:\n          _context4.next = 10;\n          return this.getInfo(contractAddress);\n\n        case 10:\n          data = _context4.sent;\n\n          if (!(data.result === '')) {\n            _context4.next = 13;\n            break;\n          }\n\n          return _context4.abrupt(\"return\", this._responseData(''));\n\n        case 13:\n          return _context4.abrupt(\"return\", this._responseData({\n            symbol: data.result.symbol\n          }));\n\n        case 16:\n          _context4.prev = 16;\n          _context4.t0 = _context4[\"catch\"](0);\n          throw _context4.t0;\n\n        case 19:\n        case \"end\":\n          return _context4.stop();\n      }\n    }\n  }, _callee4, this, [[0, 16]]);\n});\nproto.getDecimals =\n/*#__PURE__*/\n_regeneratorRuntime.mark(function _callee5(contractAddress) {\n  var isContractAddress, data;\n  return _regeneratorRuntime.wrap(function _callee5$(_context5) {\n    while (1) {\n      switch (_context5.prev = _context5.next) {\n        case 0:\n          _context5.prev = 0;\n\n          if (keypair.checkAddress(contractAddress)) {\n            _context5.next = 3;\n            break;\n          }\n\n          return _context5.abrupt(\"return\", this._responseError(errors.INVALID_CONTRACTADDRESS_ERROR));\n\n        case 3:\n          _context5.next = 5;\n          return this._isContractAddress(contractAddress);\n\n        case 5:\n          isContractAddress = _context5.sent;\n\n          if (isContractAddress) {\n            _context5.next = 8;\n            break;\n          }\n\n          return _context5.abrupt(\"return\", this._responseError(errors.CONTRACTADDRESS_NOT_CONTRACTACCOUNT_ERROR));\n\n        case 8:\n          _context5.next = 10;\n          return this.getInfo(contractAddress);\n\n        case 10:\n          data = _context5.sent;\n\n          if (!(data.result === '')) {\n            _context5.next = 13;\n            break;\n          }\n\n          return _context5.abrupt(\"return\", this._responseData(''));\n\n        case 13:\n          return _context5.abrupt(\"return\", this._responseData({\n            decimals: data.result.decimals\n          }));\n\n        case 16:\n          _context5.prev = 16;\n          _context5.t0 = _context5[\"catch\"](0);\n          throw _context5.t0;\n\n        case 19:\n        case \"end\":\n          return _context5.stop();\n      }\n    }\n  }, _callee5, this, [[0, 16]]);\n});\nproto.getTotalSupply =\n/*#__PURE__*/\n_regeneratorRuntime.mark(function _callee6(contractAddress) {\n  var isContractAddress, data;\n  return _regeneratorRuntime.wrap(function _callee6$(_context6) {\n    while (1) {\n      switch (_context6.prev = _context6.next) {\n        case 0:\n          _context6.prev = 0;\n\n          if (keypair.checkAddress(contractAddress)) {\n            _context6.next = 3;\n            break;\n          }\n\n          return _context6.abrupt(\"return\", this._responseError(errors.INVALID_CONTRACTADDRESS_ERROR));\n\n        case 3:\n          _context6.next = 5;\n          return this._isContractAddress(contractAddress);\n\n        case 5:\n          isContractAddress = _context6.sent;\n\n          if (isContractAddress) {\n            _context6.next = 8;\n            break;\n          }\n\n          return _context6.abrupt(\"return\", this._responseError(errors.CONTRACTADDRESS_NOT_CONTRACTACCOUNT_ERROR));\n\n        case 8:\n          _context6.next = 10;\n          return this.getInfo(contractAddress);\n\n        case 10:\n          data = _context6.sent;\n\n          if (!(data.result === '')) {\n            _context6.next = 13;\n            break;\n          }\n\n          return _context6.abrupt(\"return\", this._responseData(''));\n\n        case 13:\n          return _context6.abrupt(\"return\", this._responseData({\n            totalSupply: data.result.totalSupply\n          }));\n\n        case 16:\n          _context6.prev = 16;\n          _context6.t0 = _context6[\"catch\"](0);\n          throw _context6.t0;\n\n        case 19:\n        case \"end\":\n          return _context6.stop();\n      }\n    }\n  }, _callee6, this, [[0, 16]]);\n});\nproto.getBalance =\n/*#__PURE__*/\n_regeneratorRuntime.mark(function _callee7(args) {\n  var schema, msg, isContractAddress, data, info;\n  return _regeneratorRuntime.wrap(function _callee7$(_context7) {\n    while (1) {\n      switch (_context7.prev = _context7.next) {\n        case 0:\n          _context7.prev = 0;\n\n          if (!(is.array(args) || !is.object(args))) {\n            _context7.next = 3;\n            break;\n          }\n\n          return _context7.abrupt(\"return\", this._responseError(errors.INVALID_ARGUMENTS));\n\n        case 3:\n          schema = {\n            contractAddress: {\n              required: true,\n              address: true\n            },\n            tokenOwner: {\n              required: true,\n              address: true\n            }\n          };\n\n          if (this._validate(args, schema).tag) {\n            _context7.next = 7;\n            break;\n          }\n\n          msg = this._validate(args, schema).msg;\n          return _context7.abrupt(\"return\", this._responseError(errors[msg]));\n\n        case 7:\n          _context7.next = 9;\n          return this._isContractAddress(args.contractAddress);\n\n        case 9:\n          isContractAddress = _context7.sent;\n\n          if (isContractAddress) {\n            _context7.next = 12;\n            break;\n          }\n\n          return _context7.abrupt(\"return\", this._responseError(errors.CONTRACTADDRESS_NOT_CONTRACTACCOUNT_ERROR));\n\n        case 12:\n          data = {\n            optType: 2,\n            contractAddress: args.contractAddress,\n            input: JSON.stringify({\n              method: 'balanceOf',\n              params: {\n                address: args.tokenOwner\n              }\n            })\n          };\n          data = humps.decamelizeKeys(data, {\n            separator: '_'\n          }); // convert long to int\n\n          data = this._longToInt(data);\n          data = JSONbig.stringify(data);\n          _context7.next = 18;\n          return this._request('post', 'callContract', data);\n\n        case 18:\n          info = _context7.sent;\n\n          if (!info.result.query_rets[0].result) {\n            _context7.next = 24;\n            break;\n          }\n\n          info = JSONbig.parse(info.result.query_rets[0].result.value);\n          return _context7.abrupt(\"return\", this._responseData(info));\n\n        case 24:\n          return _context7.abrupt(\"return\", this._responseError(errors.NO_SUCH_TOKEN_ERROR));\n\n        case 25:\n          _context7.next = 30;\n          break;\n\n        case 27:\n          _context7.prev = 27;\n          _context7.t0 = _context7[\"catch\"](0);\n          throw _context7.t0;\n\n        case 30:\n        case \"end\":\n          return _context7.stop();\n      }\n    }\n  }, _callee7, this, [[0, 27]]);\n});\nproto.allowance =\n/*#__PURE__*/\n_regeneratorRuntime.mark(function _callee8(args) {\n  var schema, msg, isContractAddress, data, info;\n  return _regeneratorRuntime.wrap(function _callee8$(_context8) {\n    while (1) {\n      switch (_context8.prev = _context8.next) {\n        case 0:\n          _context8.prev = 0;\n\n          if (!(is.array(args) || !is.object(args))) {\n            _context8.next = 3;\n            break;\n          }\n\n          return _context8.abrupt(\"return\", this._responseError(errors.INVALID_ARGUMENTS));\n\n        case 3:\n          schema = {\n            contractAddress: {\n              required: true,\n              address: true\n            },\n            tokenOwner: {\n              required: true,\n              address: true\n            },\n            spender: {\n              required: true,\n              address: true\n            }\n          };\n\n          if (this._validate(args, schema).tag) {\n            _context8.next = 7;\n            break;\n          }\n\n          msg = this._validate(args, schema).msg;\n          return _context8.abrupt(\"return\", this._responseError(errors[msg]));\n\n        case 7:\n          _context8.next = 9;\n          return this._isContractAddress(args.contractAddress);\n\n        case 9:\n          isContractAddress = _context8.sent;\n\n          if (isContractAddress) {\n            _context8.next = 12;\n            break;\n          }\n\n          return _context8.abrupt(\"return\", this._responseError(errors.CONTRACTADDRESS_NOT_CONTRACTACCOUNT_ERROR));\n\n        case 12:\n          data = {\n            optType: 2,\n            contractAddress: args.contractAddress,\n            input: JSON.stringify({\n              method: 'allowance',\n              params: {\n                owner: args.tokenOwner,\n                spender: args.spender\n              }\n            })\n          };\n          data = humps.decamelizeKeys(data, {\n            separator: '_'\n          }); // convert long to int\n\n          data = this._longToInt(data);\n          data = JSONbig.stringify(data);\n          _context8.next = 18;\n          return this._request('post', 'callContract', data);\n\n        case 18:\n          info = _context8.sent;\n\n          if (!info.result.query_rets[0].result) {\n            _context8.next = 24;\n            break;\n          }\n\n          info = JSONbig.parse(info.result.query_rets[0].result.value);\n          return _context8.abrupt(\"return\", this._responseData(info));\n\n        case 24:\n          return _context8.abrupt(\"return\", this._responseError(errors.NO_SUCH_TOKEN_ERROR));\n\n        case 25:\n          _context8.next = 30;\n          break;\n\n        case 27:\n          _context8.prev = 27;\n          _context8.t0 = _context8[\"catch\"](0);\n          throw _context8.t0;\n\n        case 30:\n        case \"end\":\n          return _context8.stop();\n      }\n    }\n  }, _callee8, this, [[0, 27]]);\n});\nwrap(proto);","map":null,"metadata":{},"sourceType":"script"}